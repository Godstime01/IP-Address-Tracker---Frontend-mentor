<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- displays site properly based on user's device -->

  <link rel="icon" type="image/png" sizes="32x32" href="./images/favicon-32x32.png">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
    integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI=" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
    integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=" crossorigin=""></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">

  <title>IP Address Tracker</title>

<body>

  <div class="container">
    <div class="top__item">
      <h2 class="title">Malaria burden reporting system</h2>

      <form action="" id="form" method="post">
        <select class="ip_address" name="select" id="select">
          <option value=""></option>
        </select>
        <!-- <input type="text" class="ip_address" placeholder=" Search for any IP address or domain"> -->
        <button type="submit" class="btn"><img src="images/icon-arrow.svg" alt="icon-arrow"></button>
      </form>
    </div>

    <div class="bottom__item">
      <div class="overlay">

        <div class="item">
          <div class="item__title">Direct Cost</div>
          <h2 class="ip">

          </h2>
        </div>

        <div class="item">
          <div class="item__title">Indirect Cost</div>
          <h2 class="location"></h2>
        </div>

        <div class="item">
          <div class="item__title">Total Cost</div>
          <h2 class="timezone"></h2>
        </div>

        <div class="item">
          <div class="item__title">Remark</div>
          <h2 class="isp"></h2>
        </div>


      </div>
      <div id="map">

      </div>
    </div>

    <div class="loading">
      <div class="lds-ripple">
        <div></div>
        <div></div>
      </div>
    </div>
  </div>

  <script>

    const form = document.getElementById("form");
    const select = document.querySelector(".ip_address");
    const btn = document.querySelector(".btn");
    const items = document.querySelectorAll(".item")
    let DATA = {}

    window.addEventListener("load", (event) => {
      fetch("data.json")
        .then(res => res.json())
        .then(data => {
          document.querySelector(".loading").style.display = "None";

          data.map(item => {
            // console.log(item)
            myOption = document.createElement("option");
            myOption.text = item.location;
            myOption.value = item.location;
            select.appendChild(myOption);
          })
          DATA = data
          
        })
        mapLocation(4.623275, 7.766819)
    });


    function mapLocation(lat, lng) {
      var myIcon = L.icon({
        iconUrl: '/images/icon-location.svg',
        iconSize: [20, 40],
        iconAnchor: [22, 94],
      });

      map.setView([lat, lng], 14)

      L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 13,
        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
      }).addTo(map);

      var marker = L.marker([lat, lng], { icon: myIcon }).addTo(map);
    }

    // Map
    var map = L.map('map').setView([51.505, -0.09], 13);

    
    form.addEventListener("submit", e => {
      e.preventDefault()

      value = select.options[select.selectedIndex].value.toLowerCase();
      // console.log(DATA)
      
      DATA.map(item => {
        
        console.log(item)
        if(item.location == value){
          const lat = item.pos[0]
          const lng = item.pos[1];
          mapLocation(lat, lng)
          
          items[0].lastElementChild.innerText = item.d_cost;
          items[1].lastElementChild.innerText = item.in_cost;
          items[2].lastElementChild.innerText = item.total;
          items[3].lastElementChild.innerText = item.remark;
        }
      })
      console.log(DATA[value])
      const [lat, lng] = DATA[value]
      

    })

  </script>
</body>

</html>